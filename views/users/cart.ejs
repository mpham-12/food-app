<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="/styles/navbar.css">


  <title>Milkies</title>
</head>

<body>
  <%- include('../partials/navbar.ejs') %>


    <h1>Cart</h1>
    <% if (!id) {%>
      <h2>Empty bag. Please log in to place an order</h2>
      <% } %>

        <% if (id && cart.length===0) {%>
          <h3> Hi <%=user.firstName %>, your cart is empty. </h3>
          <% } %>

            <% if (id && cart.length>0) {%>
              <h2>Review your order</h2>
              <% for (let item of cartItems) {%>
                <div>

                  <div><img src=<%=item.image%> alt="" style="height:150px"></div>
                  <%=item.quantity%>x <%=item.drinkName%>
                      <ul>
                        <li>
                          <%=item.size[0].size%> +<%=item.size[0].price%>
                        </li>

                  
                          <% for (topping of item.topping){ %>
                           <li> <%=topping.toppingName%> +<%=topping.price.toFixed(2)%></li>
                             
                                <% } %>
                        
                        <li>
                          <%=item.sugarLevel%> Sugar
                        </li>
                        <li>
                          <%=item.iceLevel%>
                        </li>
                        <li>
                          <%=item.milkType[0].milkName%> +<%=item.milkType[0].price%>
                        </li>
                      </ul>
                </div>
                <div>
                  <% let toppingsArr=[] %>
                    <% for (topping of item.topping){ %>
                      <% toppingsArr.push(topping.price) %>
                        <% }%>
                            <% const allToppings=toppingsArr.reduce((previousValue, currentValue) => previousValue + currentValue)%>

                              <% let drinkTotal=(4.99 + item.milkType[0].price + item.size[0].price+ allToppings)*item.quantity %>
                                Total: <%=drinkTotal.toFixed(2)%>
                </div>
                <form action="" method="">
                  <button>Edit</button>
                </form>
                <form action="/user/cart?_method=DELETE" method="POST">
                    <button>Delete</button>
                  </form>
                  <%}%>
                    <%if (cart.length<1){%>
                      <button>Go to menu</button>
                      <%} else {%>
                        
                        <a href="/user/checkout">Go to Checkout</a>
                        <%}%>
                        <%}%>

</body>

</html>